<html>
<head>
  <script type="text/javascript" src="musis.js"></script>
  <script type="text/javascript" src="adapters/play.js"></script>
  <script type="text/javascript" src="adapters/play.percussion.js"></script>
  <script type="text/javascript" src="adapters/play.string.js"></script>
  <script type="text/javascript" src="adapters/play.phoneme_ah.js"></script>
  <script type="text/javascript" src="adapters/play.celeste.js"></script>
  <script type="text/javascript" src="adapters/play.piano.js"></script>
  <script type="text/javascript" src="adapters/draw.js"></script>
  <script type="text/javascript" src="adapters/draw.trigger.js"></script>
  <script type="text/javascript" src="adapters/draw.star.js"></script>
  <script type="text/javascript" src="adapters/draw.terrain.js"></script>
  <script type="text/javascript" src="music/key.js"></script>
  <script type="text/javascript" src="music/note.js"></script>
  <script type="text/javascript" src="music/voicing.js"></script>
  <script type="text/javascript" src="music/compose.js"></script>
  <script type="text/javascript" src="music/tension.js"></script>
  <script type="text/javascript" src="music/music.js"></script>
  <script type="text/javascript" src="music/metronome.js"></script>
  <script type="text/javascript" src="music/analysis.js"></script>
  <script type="text/javascript" src="triggers.js"></script>
  <script type="text/javascript" src="stars.js"></script>
  <script type="text/javascript" src="terrain.js"></script>
  <script type="text/javascript" src="perform.js"></script>
  <script type="text/javascript" src="game.js"></script>
  <style>
  .fullscreen {
    position:absolute;
    top:0%;
    left:0%;
    width:100%;
    height:100%;
  }
  </style>
  </head>
<body style="margin:0px;">
  <canvas id="canvas" class="fullscreen" style="width:100%; height:100%;"></canvas>
  <div id="info" class="fullscreen" style="color:white; font-family:helvetica,arial;">
    <h1 id="title"></h1>
    <h5 id="hint"></h5>
    <h3>Score: <span id="score"></span></h3>
  </div>
  <script type="text/javascript">

/*
** level 1: Harmony
x evaluate quality of chords and progressions
 x analyse harmony as stacked thirds; determine chord root
 x move tension calculation into analysis
 x functional T/S/D evaluation
 x show analysis onscreen
  x rejig terrain to reflect analysis not notes
x Analyse and represent different types and qualities of chords in the terrain
 x single note:
 x one third:
 x triad:
 x 1-5 power chords:
x 1.1: tonic harmony
 x setup: which triggers
  x Ability to disable triggers
 x info display
 x game domain component
  x move info panel display into game
  x move trigger configuration into game
 x completion criteria
  x test and move to next level
* analyse score
 * score more for variety?
 ?? Should score be defined solely by the game..?
  * Yes this is logical
  * so for the static harmony level, score for switching between tonic and dominant functions...
* 1.2: static harmony
* look for cadences
* 1.3: perfect cadence
* 1.4: interrupted cadence?
* 1.5: secondary dominants
* 1.6: dominant modulation
* 1.7: ??
* when hit tonic after perfect cadence, fill out the tonic chord for richer sound
* Modulation
 * add extra triggers for more notes: f# then c# then Bb then Ab etc
 * detect modulations
 * indicate key with a small border around the triggers: blue if in tonic key, red for dominant etc
 * Analyse chord root
* Voicing: score against parallel fifths/octaves
* Voicing: score to encourage tritone resolution
* Analyse and represent different types and qualities of chords in the terrain
 * sus4/sus2:
** Rhythm
* ux for defining tempo and rhythm
** Melody
* use harmony notes on downbeats
* ensure the bass changes on a downbeat
* when queuing up notes to play later, should queue up starbursts etc too
* extra notes and melody kick in if make good progressions
* grow interesting visual objects when doing well
* ux for arpeggio/block chord/voice leading etc
** Other
* tick sound when select a trigger?
* Try getting motion blur by using alpha rect instead of clearing the back buffer (still need to clear z)
* Instruments from FFTs: http://www.sitepoint.com/using-fourier-transforms-web-audio-api/
* Show selected triggers and current touch linked up with glowing, pulsing, smooth lines
! loadVertexAttrib sucks; DONT create and discard a new vertex buffer every frame unless you need to!!
*/

musis.info = {
  title: function (t) { document.getElementById("title").innerHTML = t; },
  hint: function (t) { document.getElementById("hint").innerHTML = t; },
  score: function (s) { document.getElementById("score").innerHTML = s; }
};

musis.begin();

var canvas = document.getElementById("canvas");

function onResize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};
window.addEventListener('resize', onResize, false);
onResize();

var ctxGl = canvas.getContext("webgl");
if (!ctxGl) { ctxGl = canvas.getContext("experimental-webgl"); }
var tLast;
var frame = function (t) {
  if (tLast) {
    musis.frame(t, (t - tLast)/1000, ctxGl, canvas.width, canvas.height);
  }
  tLast = t;
  window.requestAnimationFrame(frame);
};
window.requestAnimationFrame(frame);

var touched = false;
var mousedown = false;
window.onmousedown = function (evt) {
  if (touched) { return; }
  mousedown = true;
  musis.touchstart(evt.clientX, evt.clientY);
};
window.onmousemove = function (evt) {
  if (touched) { return; }
  if (mousedown) {
    musis.touchmove(evt.clientX, evt.clientY);
  }
};
window.onmouseup = function (evt) {
  if (touched) { return; }
  musis.touchend();
  mousedown = false;
};

window.addEventListener("touchstart", function (evt) {
  touched = true;
  musis.touchstart(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
window.addEventListener("touchmove", function (evt) {
  musis.touchmove(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
window.addEventListener("touchend", function (evt) {
  musis.touchend();
});

  </script>
</body>
</html>
