<html>
<head>
  <script type="text/javascript" src="musis.js"></script>
  <script type="text/javascript" src="triggers.js"></script>
</head>
<body>
  <canvas id="canvas" width="960" height="540"></canvas>
  <script type="text/javascript">

/*
x Have mouse/touch handling in here and call through to js
x Make rendered object react to touch
x Have multiple trigger objects
* Touch-selecting issues
 x Fix incorrect offset in hit testing vs drawing
 x Need to select all triggers between last touch point and next (to avoid fast fingers skipping triggers)
 x Last touch point should still select triggers that pass over (until touchend anyway)
 * Can it be broken by multiple touches?
* Refactor drawing into adapter
 * Move hue into adapter
* Arrange triggers
* Show selected triggers linked up with glowing smooth lines
* Have audio triggered by touch
* Launch groups of triggers
* Evaluate 
* Fireworks/lights/structures when do well
* Add beats
* Gestures for arpeggio/block chord etc
* Levels
*/

musis.init();

var canvas = document.getElementById("canvas");
var ctx2d = canvas.getContext("2d");
var tLast;
var frame = function (t) {
  if (tLast) {
    musis.frame(t - tLast, ctx2d, canvas.width, canvas.height);
  }
  tLast = t;
  window.requestAnimationFrame(frame);
};
window.requestAnimationFrame(frame);

var mousedown = false;
canvas.onmousedown = function (evt) {
  mousedown = true;
  musis.touchstart(evt.clientX, evt.clientY);
};
canvas.onmousemove = function (evt) {
  if (mousedown) {
    musis.touchmove(evt.clientX, evt.clientY);
  }
};
canvas.onmouseup = function (evt) {
  musis.touchend(evt.clientX, evt.clientY);
  mousedown = false;
};

canvas.addEventListener("touchstart", function (evt) {
  musis.touchstart(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
canvas.addEventListener("touchmove", function (evt) {
  musis.touchmove(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
canvas.addEventListener("touchup", function (evt) {
  musis.touchend(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});


  </script>
</body>
</html>
