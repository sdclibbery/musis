<html>
<head>
  <script type="text/javascript" src="musis.js"></script>
</head>
<body>
  <canvas id="canvas" width="960" height="540"></canvas>
  <script type="text/javascript">

/*
* Have mouse down/drag/up handling in here and call through to js
* Make rendered object react to touch
* Have audio triggered by touch
* Have diatonic notes with correct frequencies
* Show selected notes linked up with glowing lines
* Add a beat
* 
*/

var canvas = document.getElementById("canvas");
var ctx2d = canvas.getContext("2d");
var tLast;
var frame = function (t) {
  if (tLast) {
    musis.frame(t - tLast, ctx2d, canvas.width, canvas.height);
  }
  tLast = t;
  window.requestAnimationFrame(frame);
}
window.requestAnimationFrame(frame);



var context = new AudioContext();

/* VCO */
var vco = context.createOscillator();
vco.type = vco.SINE;
vco.frequency.value = this.frequency;
vco.start(0);

/* VCA */
var vca = context.createGain();
vca.gain.value = 0;

/* Connections */
vco.connect(vca);
vca.connect(context.destination);

var f = 110;
vco.frequency.value = f;

canvas.onmousedown = function () {
  vco.frequency.value = f;
  f *= Math.pow(2, 1/12);
  console.log(f);
  vca.gain.value = 1;
};

canvas.onmouseup = function () {
  vca.gain.value = 0;
};



  </script>
</body>
</html>
