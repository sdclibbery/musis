<html>
<head>
  <script type="text/javascript" src="musis.js"></script>
  <script type="text/javascript" src="play.js"></script>
  <script type="text/javascript" src="draw.js"></script>
  <script type="text/javascript" src="stars.js"></script>
  <script type="text/javascript" src="draw.star.js"></script>
  <script type="text/javascript" src="triggers.js"></script>
  <script type="text/javascript" src="draw.trigger.js"></script>
  <script type="text/javascript" src="metronome.js"></script>
</head>
<body>
  <canvas id="canvas" width="960" height="540"></canvas>
  <script type="text/javascript">

/*
x Have mouse/touch handling in here and call through to js
x Make rendered object react to touch
x Have multiple trigger objects
x Touch-selecting issues
x Refactor drawing into adapter
x Arrange triggers
x Break draw and play out into own modules
x Have audio triggered by touchend
x When triggers play
 x fireworks
 x clear and start new triggers
x Use webgl canvas context
 x clear using webgl
 x basic drawing using webgl
 x trigger selected status
x Glows/effects for triggers and stars
x Refactoring and tidy up drawing
x Pulse and rhythm
 x experiment with noise from custom oscillator type...
 x metronome
x use metronome to place trigger sounds at exact beat times
* visual metronome indication
* tick sound when select a trigger
* Basic chord voicing
 * appropriate bass (first selected note?)
 * sensible spacing of other notes
* Show selected triggers and current touch linked up with glowing, pulsing, smooth lines
* Evaluate quality of chords and progressions
* Extra notes and melody kick in if make good progressions
 * when hit tonic after perfect cadence, fill out the tonic chord for richer sound
* Visual fx: build structures/lights etc
* Gestures for arpeggio/block chord/voice leading etc
* Instruments from FFTs: http://www.sitepoint.com/using-fourier-transforms-web-audio-api/
* Entire star lifetime should be in vertex shader
 * so have more stars :-)
* Try getting motion blur by using alpha rect instead of clearing the back buffer (still need to clear z)
*/

musis.begin();

var canvas = document.getElementById("canvas");
var ctxGl = canvas.getContext("webgl");
if (!ctxGl) { ctxGl = canvas.getContext("experimental-webgl"); }
var tLast;
var frame = function (t) {
  if (tLast) {
    musis.frame((t - tLast)/1000, ctxGl, canvas.width, canvas.height);
  }
  tLast = t;
  window.requestAnimationFrame(frame);
};
window.requestAnimationFrame(frame);

var touched = false;
var mousedown = false;
canvas.onmousedown = function (evt) {
  if (touched) { return; }
  mousedown = true;
  musis.touchstart(evt.clientX, evt.clientY);
};
canvas.onmousemove = function (evt) {
  if (touched) { return; }
  if (mousedown) {
    musis.touchmove(evt.clientX, evt.clientY);
  }
};
canvas.onmouseup = function (evt) {
  if (touched) { return; }
  musis.touchend();
  mousedown = false;
};

canvas.addEventListener("touchstart", function (evt) {
  touched = true;
  musis.touchstart(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
canvas.addEventListener("touchmove", function (evt) {
  musis.touchmove(evt.changedTouches[0].clientX, evt.changedTouches[0].clientY);
});
canvas.addEventListener("touchend", function (evt) {
  musis.touchend();
});


  </script>
</body>
</html>
